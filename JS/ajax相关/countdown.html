<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- CSS -->
    <link rel="stylesheet" type="text\css" href="">
    <style>

    </style>
</head>

<body>
    <!-- JS -->
    
    <script>
        // 获取当前时间应为服务器时间
        //请求方式 HEAD AJAX状态2 即可获得
        // 每隔一秒重新计算时间差
        let target = new Date('2020/11/11 18:00:00'),
            now = new Date(),
            timer = null;

        function queryServerTime(callback){
            let xhr = new XMLHttpRequest;
            xhr.open('HEAD','./data.json');
            xhr.onreadystatechange=()=>{
                if(xhr.status === 200 && xhr.readyState === 2)
                {
                    let time = xhr.getResponseHeader('Date');
                    callback && callback(new Date(time));
                }

            };
            xhr.send(null);
        }

        function computed(){
            let spanTime = target - now;
            if(spanTime<=0){
                //到达抢购时间
                clearInterval(timer);
                box.innerHTML="Start!";
                return;
            }
            let hours = Math.floor(spanTime / (60*60*1000));
            spanTime = spanTime - hours * 60*60*1000;
            let minutes =  Math.floor(spanTime / (60*1000));
            spanTime = spanTime - minutes * 60*1000;
            let seconds =  Math.floor(spanTime / 1000);

            hours < 10 ? hours = '0' + hours : null;
            minutes < 10 ? minutes = '0' + minutes : null;
            seconds < 10 ? seconds = '0' + seconds : null;
            box.innerHTML = `距离抢购还剩: ${hours}小时${minutes}分${seconds}秒`;
        }

        queryServerTime(time =>{
            //获取到服务器信息后触发的事情
            now = time;
            //计算时间差
            computed();
            //每间隔一秒钟，在现有时间 +1秒，重新计算时间差
            timer = setInterval(_ => {
                now = new Date(+now + 1000);
                computed();
            }, 1000);
        });
    </script>
    <div id="box">
        距离抢购：00小时00分00秒
    </div>
</body>

</html>